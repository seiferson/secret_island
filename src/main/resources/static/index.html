<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.0/dist/semantic.min.css">
  <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.0/dist/semantic.min.js"></script>
  <title>Secret Island</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <div class="ui container">
    <br />
    <br />
    <br />

    <div class="ui segment">
      <h2 class="ui center aligned icon header">
        <i class="circular campground icon"></i>Secret Island
      </h2>
    </div>

    <br />
    <br />
    <br />

    <div class="ui grid">

      <div class="eight wide column"></div>

      <div class="eight wide column">
        <div class="ui basic segment">
          <div class="ui top left attached label">App change log @v0.0.1-SNAPSHOT</div>

          <div class="ui placeholder" id="feed_placeholder">
            <div class="image header">
              <div class="line"></div>
              <div class="line"></div>
            </div>
            <div class="image header">
              <div class="line"></div>
              <div class="line"></div>
            </div>
            <div class="image header">
              <div class="line"></div>
              <div class="line"></div>
            </div>
            <div class="image header">
              <div class="line"></div>
              <div class="line"></div>
            </div>
          </div>

          <div class="ui feed" id="feed"></div>
        </div>
      </div>
    </div>


      <br />
      <br />
      <br />

      <div class="ui segment">
        <p>Powered by <a href="https://www.heroku.com/">Heroku</a> and <a href="https://www.mongodb.com/">Atlas</a></p>
        <p>Made with ‚ù§ by <a href="https://github.com/seiferson">@seiferson</a>  2022</p>
        <p><a href="/api/v1">API</a></p>
      </div>
    </div>
  </div>

  <script>
    fetch('/api/v1/hPosts')
      .then(response => {
        return response.json();
      })
      .then( response => {
        if(response.page.totalElements > 0) {
          document.getElementById('feed_placeholder').remove();
          var feed = document.getElementById('feed');
          response._embedded.hPosts.forEach(hPost => {
            var post = document.createElement("div");
            post.classList.add("event")

            var label = document.createElement("div");
            label.classList.add("label");

            var img = document.createElement('img');
            img.src = "https://avatars.dicebear.com/api/open-peeps/seiferson.svg?head=mohawk&face=blank&skinColor=variant02&hairColor=variant06";

            label.appendChild(img);
            post.appendChild(label);

            var content = document.createElement("div");
            content.classList.add("content");

            var summary = document.createElement("div");
            summary.classList.add("summary");

            var author = document.createElement("a");
            author.classList.add("user");
            author.href = "https://github.com/" + hPost.author;
            var authorText = document.createTextNode("@" + hPost.author);
            author.appendChild(authorText);
            summary.appendChild(author);

            var date =  document.createElement("div");
            date.classList.add("date");
            var dateText = document.createTextNode(hPost.postedDate);
            date.appendChild(dateText);

            summary.appendChild(date);
            content.appendChild(summary);

            var text = document.createElement("div");
            text.classList.add("extra");
            text.classList.add("text");
            var contentText = document.createTextNode(hPost.content);
            text.appendChild(contentText);

            content.appendChild(text);
            post.appendChild(content);
            feed.appendChild(post);
          });
        }
      });
  </script>
</body>
</html>